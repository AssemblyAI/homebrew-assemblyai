# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class Assemblyai < Formula
  desc "A quick and easy way to test assemblyAI's transcription features on your terminal"
  homepage "https://www.assemblyai.com/"
  version "0.34"
  license "Apache 2.0"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/AssemblyAI/assemblyai-cli/releases/download/v0.34/assemblyai_0.34_darwin_amd64.tar.gz"
      sha256 "17809bd12856421fa2f75bafdd68c123d5599bbb4b60c264131751c874290679"

      def install
        bin.install "assemblyai"
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/AssemblyAI/assemblyai-cli/releases/download/v0.34/assemblyai_0.34_darwin_arm64.tar.gz"
      sha256 "afd5029260b07af267783b669bf5f6e2b67b86ac303dccb5e1e47d7a4bad4d07"

      def install
        bin.install "assemblyai"
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel?
      url "https://github.com/AssemblyAI/assemblyai-cli/releases/download/v0.34/assemblyai_0.34_linux_amd64.tar.gz"
      sha256 "3750a91fc45b5d28dcd7c0462a0ec1854256c80d631ce804c205c8299f55bea3"

      def install
        bin.install "assemblyai"
      end
    end
    if Hardware::CPU.arm? && !Hardware::CPU.is_64_bit?
      url "https://github.com/AssemblyAI/assemblyai-cli/releases/download/v0.34/assemblyai_0.34_linux_armv6.tar.gz"
      sha256 "2b501b745803b31079610a11fd2fa9ab62fcb5dfef16ba7105227bfbc95a1cc1"

      def install
        bin.install "assemblyai"
      end
    end
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/AssemblyAI/assemblyai-cli/releases/download/v0.34/assemblyai_0.34_linux_arm64.tar.gz"
      sha256 "e4e446b86096486e0c7c1e9cfa18f094840e4b814849040cdd6587fe714b7416"

      def install
        bin.install "assemblyai"
      end
    end
  end

  def post_install
    etc.install "Welcome to AssemblyAI CLI"
    system "assemblyai", "welcome", "-i", "-v=v0.34", "-m=brew"
  end

  test do
    output = shell_output("#{bin}/assemblyai config 1234567890")
    expected = "Invalid token. Try again, and if the problem persists, contact support at support@assemblyai.com"
    assert_match expected, output

    output = shell_output("#{bin}/assemblyai transcribe 1234567890")
    assert_match "You must login first. Run `assemblyai config <token>`\n", output

    output = shell_output("#{bin}/assemblyai get 1234567890")
    assert_match "You must login first. Run `assemblyai config <token>`\n", output
  end
end
